!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).leafletKnn=f()}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){var sphereKnn=require("sphere-knn");function collapse(results){for(var l=[],included={},i=0;i<results.length;i++)null==included[L.stamp(results[i].layer)]&&(l.push(results[i]),included[L.stamp(results[i].layer)]=!0);return l}function reformat(coords,layer){for(var l=[],i=0;i<coords.length;i++)l.push({lon:coords[i][0],lat:coords[i][1],layer:layer});return l}function flat(coords){var i=0,j=0,k=0,l=[];if("object"==typeof coords[0]&&"object"==typeof coords[0][0]&&"object"==typeof coords[0][0][0])for(;i<coords.length;i++)for(;j<coords[i].length;j++)for(;k<coords[i][j].length;k++)l.push(coords[i][j][k]);else{if("object"!=typeof coords[0]||"object"!=typeof coords[0][0])return"object"==typeof coords[0]?coords:[coords];for(;i<coords.length;i++)for(;j<coords[i].length;j++)l.push(coords[i][j])}return l}module.exports=function(layer){"use strict";if(!(layer instanceof L.GeoJSON))throw new Error("must be L.GeoJSON");var points=[];layer.eachLayer(function(l){points.push(...reformat(flat(l.feature.geometry.coordinates),l))});var sknn=sphereKnn(points);return sknn.nearest=function(p,n,max_distance){return p instanceof L.LatLng&&(p=[p.lng,p.lat]),sknn(p[1],p[0],n,max_distance)},sknn.nearestLayer=function(p,n,max_distance){return p instanceof L.LatLng&&(p=[p.lng,p.lat]),collapse(sknn(p[1],p[0],n,max_distance))},sknn}},{"sphere-knn":2}],2:[function(require,module,exports){var spherekd=require("./lib/spherekd");module.exports=function(points){var root=spherekd.build(points);return function(lat,lon,n,max){return spherekd.lookup(lat,lon,root,n,max)}}},{"./lib/spherekd":5}],3:[function(require,module,exports){function defaultComparator(a,b){return a-b}exports.search=function(item,array,comparator){comparator=comparator||defaultComparator;for(var mid,comp,low=0,high=array.length-1;low<=high;)if((comp=comparator(array[mid=low+high>>>1],item))<0)low=1+mid;else{if(!(0<comp))return mid;high=mid-1}return-(low+1)},exports.insert=function(item,array,comparator){comparator=exports.search(item,array,comparator);array.splice(comparator=comparator<0?-(comparator+1):comparator,0,item)}},{}],4:[function(require,module,exports){var binary=require("./binary");function Node(axis,split,left,right){this.axis=axis,this.split=split,this.left=left,this.right=right}function byDistance(a,b){return a.dist-b.dist}exports.build=function(array){return function buildrec(array,depth){var axis,i;return 0===array.length?null:1===array.length?array[0]:(axis=depth%array[0].position.length,array.sort(function(a,b){return a.position[axis]-b.position[axis]}),i=Math.floor(.5*array.length),++depth,new Node(axis,array[i].position[axis],buildrec(array.slice(0,i),depth),buildrec(array.slice(i),depth)))}(array,0)},exports.lookup=function(position,node,n,max){0<max||(max=Number.POSITIVE_INFINITY);var array=[];if(!(null===node||n<=0)){for(var dist,i,stack=[node,0];stack.length;)if(dist=stack.pop(),node=stack.pop(),!(max<dist||array.length===n&&array[array.length-1].dist<dist*dist)){for(;node instanceof Node;)node=position[node.axis]<node.split?(stack.push(node.right,node.split-position[node.axis]),node.left):(stack.push(node.left,position[node.axis]-node.split),node.right);(dist=function(a,b){for(var k,i=Math.min(a.length,b.length),d=0;i--;)d+=(k=b[i]-a[i])*k;return d}(position,node.position))<=max*max&&binary.insert({object:node,dist:dist},array,byDistance),array.length>n&&array.pop()}for(i=array.length;i--;)array[i]=array[i].object}return array}},{"./binary":3}],5:[function(require,module,exports){var kd=require("./kd"),rad=Math.PI/180;function spherical2cartesian(lat,lon){lat*=rad,lon*=rad;var cos=Math.cos(lat);return[cos*Math.cos(lon),Math.sin(lat),cos*Math.sin(lon)]}function Position(object){var lat,lon;object.hasOwnProperty("lat")?lat=object.lat:object.hasOwnProperty("latitude")?lat=object.latitude:object.hasOwnProperty("location")&&Array.isArray(object.location)&&2===object.location.length&&(lat=object.location[0]),object.hasOwnProperty("lon")?lon=object.lon:object.hasOwnProperty("longitude")?lon=object.longitude:object.hasOwnProperty("lng")?lon=object.lng:object.hasOwnProperty("long")?lon=object.long:object.hasOwnProperty("location")&&Array.isArray(object.location)&&2===object.location.length&&(lon=object.location[1]),this.object=object,this.position=spherical2cartesian(lat,lon)}exports.build=function(array){for(var i=array.length,out=new Array(i);i--;)out[i]=new Position(array[i]);return kd.build(out)},exports.lookup=function(lat,lon,node,n,max){for(var array=kd.lookup(spherical2cartesian(lat,lon),node,n,0<max?2*Math.sin(max*(1/12742018)):void 0),i=array.length;i--;)array[i]=array[i].object;return array}},{"./kd":4}]},{},[1])(1)});
